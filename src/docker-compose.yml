services:
  backend:
    build:
      context: ./api
    image: printhub-api:latest
    command: bash -c "
        python manage.py migrate
        && python manage.py collectstatic --noinput
        && gunicorn --bind 0.0.0.0:8000 --workers 3 pocprintapi.wsgi:application
      "
    container_name: printhub-api
    restart: always
    ports:
      - "8000:8000"
    environment:
      - POC_PRINT_HUB_RABBIT_MQ_HOST=
      - POC_PRINT_HUB_RABBIT_MQ_USERNAME=
      - POC_PRINT_HUB_RABBIT_MQ_PASSWORD=
      - POC_PRINT_HUB_PRINTER_HOST=
      - DATABASES_POSTGRESQL_USER=
      - DATABASES_POSTGRESQL_PASSWORD=
      - DATABASES_POSTGRESQL_HOST=
      - DJANGO_ALLOWED_HOSTS=127.0.0.1    # comma separated for multiple
  celery_beat:
    build:
      context: ./api
    image: printhub-celery-beat:latest
    command: "celery -A pocprintapi beat -l info"
    container_name: printhub-celery-beat
    restart: always
    environment:
      - POC_PRINT_HUB_RABBIT_MQ_HOST=
      - POC_PRINT_HUB_RABBIT_MQ_USERNAME=
      - POC_PRINT_HUB_RABBIT_MQ_PASSWORD=
      - POC_PRINT_HUB_PRINTER_HOST=
  celery_worker:
    build:
      context: ./api
    image: printhub-celery-worker:latest
    command: "celery -A pocprintapi worker -l INFO"
    container_name: printhub-celery-worker
    restart: always
    environment:
      - POC_PRINT_HUB_RABBIT_MQ_HOST=
      - POC_PRINT_HUB_RABBIT_MQ_USERNAME=
      - POC_PRINT_HUB_RABBIT_MQ_PASSWORD=
      - POC_PRINT_HUB_PRINTER_HOST=